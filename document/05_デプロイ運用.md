# デプロイ/運用メモ（Laravel on Xserver）

作成日: 2026-02-04

## 1. ディレクトリ配置（推奨）
Xserverのサブドメイン/ドメイン設定で「公開フォルダ（ドキュメントルート）」を `public/` に向ける。

例:
- `~/snc_library_app/`（Laravelプロジェクトのルート）
  - `public/`（公開、Webルート）
  - `app/` `bootstrap/` `config/` `database/` `resources/` `routes/` `storage/`（非公開）
  - `vendor/`（Composer依存関係、非公開）

## 2. DB
1) XserverでDBを作成  
2) Laravelマイグレーション実行:
   ```bash
   php artisan migrate
   ```
   または `document/04_DB初期化.sql` を直接実行

## 3. 環境変数（.env）
Laravelの `.env` ファイルを設定:
- `APP_KEY`: `php artisan key:generate` で生成
- `DB_HOST/DB_DATABASE/DB_USERNAME/DB_PASSWORD`: Xserver設定
- `APP_URL`: 本番URLへ
- `ADMIN_PASSWORD_HASH`: 管理者パスワードハッシュ

## 4. 依存関係のインストール
```bash
composer install --no-dev --optimize-autoloader
```

## 5. ストレージリンクの作成
```bash
php artisan storage:link
```

## 6. キャッシュの最適化（本番環境）
```bash
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

## 7. 画像アップロード上限について
要望上は「無制限」だが、実際には以下のサーバー設定上限に依存:
- PHP `upload_max_filesize`
- PHP `post_max_size`
- Webサーバー/プロキシの制限

## 8. 画像処理（Intervention Image）
本アプリは Intervention Image ライブラリを使用し、バックエンドは `Imagick` があれば優先利用、なければ `GD` にフォールバック。
環境によって WebP / アニメ画像の扱いに差が出る可能性があるため、初期導入時に1枚テストアップロード推奨。

## 9. パーミッション
```bash
chmod -R 775 storage bootstrap/cache
```

