# SNCライブラリ：仕様書

作成日: 2026-02-04  
更新日: 2026-02-05（2種類のライブラリ対応）

## 1. システム概要
本システムは、**2種類の独立したライブラリ**を管理するWebアプリケーションです：
- **グラフィックデザインライブラリ**
- **空間デザインライブラリ**

各ライブラリは独立した閲覧画面と管理ページを持ち、それぞれのライブラリ内でジャンル・タグ・画像を管理します。

## 2. システム構成（予定）
- フレームワーク: Laravel 10.x
- 言語/実行: PHP 8.1以上（Apache + PHP-FPM等、Xserver標準想定）
- DB: MySQL 8.0以上
- パッケージ管理: Composer
- 画像保存: サーバーのファイルシステム（`storage/app/public/uploads/{library_type}/` 配下、シンボリックリンク経由で公開）
- 画像処理:
  - Intervention Image（Laravel用画像処理ライブラリ）
  - バックエンド: `Imagick` があれば優先利用、なければ `GD` を利用

## 3. ライブラリ種別
- **グラフィックデザイン** (`graphic`)
  - グラフィックデザイン作品の画像を管理
  - 閲覧画面: `/graphic`
  - 管理画面: `/admin/graphic/*`
  
- **空間デザイン** (`spatial`)
  - 空間デザイン作品の画像を管理
  - 閲覧画面: `/spatial`
  - 管理画面: `/admin/spatial/*`

**重要**: 各ライブラリのジャンル・タグ・画像は完全に独立しており、相互に影響しません。

## 4. データ仕様
### 4.1 画像
- **ライブラリ種別**: 1つ（必須、`graphic` または `spatial`）
- ジャンル: 1つ（必須、ライブラリ内のジャンル）
- タグ: 複数（0個以上、ライブラリ内のタグ）
- 登録日: 自動（必須）
- メモ: 任意
- ファイル:
  - original: オリジナルファイル（保持）
  - display: 長辺4096px上限の表示用画像
  - thumb: 長辺512px目安の一覧用サムネイル

### 4.2 ジャンル/タグ
- ジャンル、タグは「事前登録制」
- **各ライブラリごとに独立したジャンル・タグを持つ**
- 画像登録/編集時は該当ライブラリ内の候補から選択

## 3. 一覧の絞り込み仕様
- ジャンル: 単一選択（未選択=全件）
- タグ: 複数選択（未選択=全件）
- タグ条件: OR（選択したいずれかのタグを含む）

## 4. 拡大表示（ライトボックス）仕様
- 画像クリックでモーダル表示
- 前後移動:
  - 左右キー/スワイプ/ボタンで前後へ
- ズーム:
  - ホイール/ピンチで拡大縮小
  - ダブルクリック/ダブルタップで切替（実装で調整）
- 表示画像:
  - 通常は `display` を表示
  - 必要に応じて `original` への切替も検討（将来拡張）

## 5. 管理ページ仕様
### 5.1 認証
- `/admin/*` は簡易パスワード必須
- **パスワードは両ライブラリ共通**（`.env`で設定し、ハッシュで保持）
- セッションでログイン状態を保持
- ログイン後は両ライブラリの管理画面にアクセス可能

### 5.2 画像アップロード
- 1回につき1枚
- 入力項目:
  - ファイル（必須）
  - ライブラリ種別（必須、グラフィック/空間）
  - ジャンル（必須、該当ライブラリ内のジャンル）
  - タグ（任意、複数、該当ライブラリ内のタグ）
  - メモ（任意）
- バリデーション:
  - MIME/拡張子
  - 画像としてデコード可能か
  - ファイルサイズ: 「無制限」要望だが、実際は PHP/Apache の上限に依存（上限到達時はエラー表示）

### 5.3 編集/削除
- 編集: ジャンル/タグ/メモ（ライブラリ種別は変更不可）
- 削除: DBレコード + `original/display/thumb` の各ファイル + 中間テーブルを削除

### 5.4 ジャンル/タグ管理
- **各ライブラリごとに独立して管理**
- 追加/編集/削除
- 削除時の扱い:
  - ジャンル削除: 紐づく画像がある場合は削除不可
  - タグ削除: 紐づく関連付けのみ削除し、画像自体は残す

## 6. テーマ切替
- ライト/ダークを切替
- `localStorage` に保存して次回も保持
- CSS変数ベースで実装

